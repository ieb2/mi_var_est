---
title: "main_doc"
author: "Ihsan E. Buker"
date: "`r Sys.Date()`"
output: html_document
---
# Dependencies 
```{r}
library(tidyverse)
library(magrittr)
library(mice)
library(boot)

library(fastDummies)
library(MASS)
```

# Toy Example 
```{r}
set.seed(971423)

cor_mat <- matrix(c(1, 0.5, 0.5, 
                    0.5, 1, 0.5, 
                    0.5, 0.5, 1), nrow = 3, ncol = 3)

mean_vec <- c(1, 5, 10)

data_complete <- mvrnorm(100, mu = mean_vec, Sigma = cor_mat)

data_w_missing <- ampute(data_complete, prop = 0.3, mech = "MAR", patterns = c(0, 1, 1))$amp

# V1 is an outcome variable with 30% MAR. Covariates are fully observed. 

# The analysis model is V1 ~ V2 + V3 + epsilon 

# Congenial imputation model 
congenial_imputation_model <- make.predictorMatrix(data_w_missing) %>%
  as.matrix()

# Uncongenial imputation model 
uncongenial_imputation_model <- make.predictorMatrix(data_w_missing) %>%
  as.matrix()

uncongenial_imputation_model[1, ] <- c(0,1,0)

# Congenial imputation 
con_imp <- mice(data_w_missing, method = "pmm", predictorMatrix = congenial_imputation_model)

# Uncongenial imputation 
uncon_imp <- mice(data_w_missing, method = "pmm", predictorMatrix = uncongenial_imputation_model)

# Fitting analysis model 

con_model <- with(con_imp, lm(V1 ~ V2 + V3)) %>%
  pool() %>%
  summary() %>%
  mutate(variance = std.error^2)

uncon_model <- with(uncon_imp, lm(V1 ~ V2 + V3)) %>%
  pool() %>%
  summary() %>%
  mutate(variance = std.error^2)
```

